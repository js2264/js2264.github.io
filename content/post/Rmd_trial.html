---
title: How to use RMarkdown?
subtitle: RMarkdown is amazing. But how to use it? 
author: Jacques Serizay
date: 2018-11-23
slug: how-to-Rmarkdown
categories:
    - R
    - markdown
tags:
    - R
    - markdown
header:
    caption: ''
    image: ''
summary: "Rmarkdown is amazing for reproducible research."
---



<p>Let’s got back to the time when I discovered the power of using Markdown. I immediatly started writing everything in Markdown. EVERYTHING. And that was great! How easy it was to produce a high-quality, well-formatted report! Those were good, early times.<br />
And then, RStudio devs came along and started working on Rmarkdown. Wow! I as blazed. Combining both worlds, really?! I love R, for all its well-developed packages and its vibrant community. And I use it literally every day. So I was thrilled. And very excited to see how things would turn out. And they turned out great, that’s for sure. There is no need today to remind how much Rmarkdown continuously improves the reproducibility of the research. I don’t use Python that much, and I felt quite jealous of Jupyter notebooks, until Rmarkdown came out.<br />
So just for the purpose of showing why Rmarkdown is so amazing, here is some code that I regularly run, to get some information about gene expression in the data I generated during my PhD.</p>
<pre class="r"><code>load(&quot;~/Documents/PhD/__Bioinfo/shared/data/classification_tissue-spe-genes-REs.RData&quot;)  # This load my gene expression datasets
# Here is the list of genes enriched in germline tissue:
germline.genes &lt;- genes.gtf %&gt;% (.$which.tissues == &quot;Germline&quot;)[] %&gt;% names()
str(germline.genes)</code></pre>
<pre><code>##  chr [1:1370] &quot;WBGene00021000&quot; &quot;WBGene00018010&quot; &quot;WBGene00021750&quot; ...</code></pre>
<p>So we can extract lists of genes, and even export it, by simply running <code>writeLines(germline.genes, con = 'genes-list.txt')</code>. Wow, easy! But can we look a little bit more into the details?</p>
<pre class="r"><code># Let&#39;s have a look at what the expression of our genes look like during
# development:
developmental.expression &lt;- LCAPdev %&gt;% germline.genes[] %&gt;% apply(., 1, scale) %&gt;% 
    t()
colnames(developmental.expression) &lt;- c(&quot;emb&quot;, &quot;L1&quot;, &quot;L2&quot;, &quot;L3&quot;, &quot;L4&quot;, &quot;YA&quot;)

# And now let&#39;s plot the results!
cols &lt;- colorRampPalette(c(&quot;darkblue&quot;, &quot;white&quot;, &quot;orange&quot;, &quot;darkred&quot;))(50)
breaks &lt;- seq(-1, 2, length.out = length(cols) + 1)
clamped.developmental.expression &lt;- clamp(developmental.expression, c(-2, 2))
pheatmap(clamped.developmental.expression, cluster_cols = F, main = &quot;Expression of germline genes during development&quot;, 
    show_rownames = F, breaks = breaks, color = cols, scale = &quot;none&quot;)</code></pre>
<p><img src="/post/Rmd_trial_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Looks ok, but can we do better? For example, the rows are automatically reorganized by hierarchical clustering. But we can see that there seem to be 3 major groups of germline genes. Let’s see if we can cluster using a k-means approach and see whether this improves the resulting heatmap.</p>
<pre class="r"><code># We can identify the clusters in our data with k-means
clusters &lt;- kmeans(developmental.expression, centers = 3)$cluster
ranked.developmental.expression &lt;- sort.per.clusters(developmental.expression, 
    clusters)

# And re-plot our heatmap
clamped.developmental.expression &lt;- clamp(ranked.developmental.expression, c(-2, 
    2))
pheatmap(clamped.developmental.expression, cluster_cols = F, cluster_rows = F, 
    main = &quot;Expression of germline genes during development&quot;, show_rownames = F, 
    breaks = breaks, color = cols, scale = &quot;none&quot;)</code></pre>
<p><img src="/post/Rmd_trial_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>This looks <strong>MUCH</strong> better now! It clearly appears that there are three major subsets of genes within the germline specific genes:<br />
- The genes almost exclusively expressed at the YA (yound adult) stage;<br />
- The genes expressed at the YA stage, with an expression already detected in L4 stage;<br />
- The genes expressed at the YA (yound adult) stage, which expression is maintained during the subsequent deveolpment of the embryo.</p>
<p>I hope this short intro to Rmarkdown is enough to prove the importance of integrating it within everyone’s R-based workflows!</p>
<hr />
<pre class="r"><code># Additional functions
sort.per.clusters</code></pre>
<pre><code>## function(df, clusters) {
##         df2 &lt;- df[0,]
##         for (cluster in unique(clusters)) {
##             tmp &lt;- df[clusters == cluster, ]
##             which.max.col &lt;- which.max(colSums(tmp))
##             tmp &lt;- tmp[order(tmp[,which.max.col], decreasing = T),]
##             df2 &lt;- rbind(df2, tmp)
##         }
##         colnames(df2) &lt;- colnames(df)
##         return(df2)
##     }
## &lt;bytecode: 0x7fe1fadd5c30&gt;</code></pre>
<pre class="r"><code>clamp</code></pre>
<pre><code>## function(df, lims = c(-99999, 99999)) {
##         df2 &lt;- as.data.frame(df)
##         df2[df2 &lt; lims[1]] &lt;- lims[1]
##         df2[df2 &gt; lims[2]] &lt;- lims[2]
##         return(df2)
##     }
## &lt;bytecode: 0x7fe1f7c69188&gt;</code></pre>
<pre class="r"><code># Session info
sessionInfo()</code></pre>
<pre><code>## R version 3.4.4 (2018-03-15)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: OS X El Capitan 10.11.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
## 
## attached base packages:
## [1] parallel  stats4    methods   stats     graphics  grDevices utils    
## [8] datasets  base     
## 
## other attached packages:
##  [1] pheatmap_1.0.8             magrittr_1.5              
##  [3] forcats_0.4.0              stringr_1.3.0             
##  [5] dplyr_0.7.6                purrr_0.2.5               
##  [7] readr_1.1.1                tidyr_0.8.0               
##  [9] tibble_1.4.2               ggplot2_3.0.0             
## [11] tidyverse_1.2.1            DESeq2_1.18.1             
## [13] BSgenome_1.46.0            GenomicAlignments_1.14.2  
## [15] Rsamtools_1.30.0           Biostrings_2.46.0         
## [17] XVector_0.21.2             SummarizedExperiment_1.8.1
## [19] DelayedArray_0.4.1         matrixStats_0.53.1        
## [21] Biobase_2.38.0             rtracklayer_1.38.3        
## [23] GenomicRanges_1.30.3       GenomeInfoDb_1.17.1       
## [25] IRanges_2.15.14            S4Vectors_0.19.17         
## [27] BiocGenerics_0.27.1       
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-131.1         bitops_1.0-6           lubridate_1.7.3       
##  [4] bit64_0.9-7            httr_1.3.1             RColorBrewer_1.1-2    
##  [7] tools_3.4.4            backports_1.1.2        R6_2.3.0              
## [10] rpart_4.1-13           Hmisc_4.1-1            DBI_1.0.0             
## [13] lazyeval_0.2.1         colorspace_1.3-2       nnet_7.3-12           
## [16] withr_2.1.2            tidyselect_0.2.4       gridExtra_2.3         
## [19] mnormt_1.5-5           bit_1.1-12             compiler_3.4.4        
## [22] cli_1.0.0              rvest_0.3.2            formatR_1.5           
## [25] htmlTable_1.11.2       xml2_1.2.0             bookdown_0.9          
## [28] scales_1.0.0           checkmate_1.8.5        psych_1.7.8           
## [31] genefilter_1.60.0      digest_0.6.17          foreign_0.8-69        
## [34] rmarkdown_1.12         base64enc_0.1-3        pkgconfig_2.0.2       
## [37] htmltools_0.3.6        readxl_1.1.0           htmlwidgets_1.3       
## [40] rlang_0.2.2            rstudioapi_0.7         RSQLite_2.0           
## [43] bindr_0.1.1            jsonlite_1.5           BiocParallel_1.12.0   
## [46] acepack_1.4.1          RCurl_1.95-4.10        GenomeInfoDbData_1.0.0
## [49] Formula_1.2-2          Matrix_1.2-12          Rcpp_0.12.19          
## [52] munsell_0.5.0          stringi_1.1.7          yaml_2.2.0            
## [55] zlibbioc_1.24.0        plyr_1.8.4             grid_3.4.4            
## [58] blob_1.1.1             crayon_1.3.4           lattice_0.20-35       
## [61] haven_1.1.1            splines_3.4.4          annotate_1.56.2       
## [64] hms_0.4.2              locfit_1.5-9.1         knitr_1.22            
## [67] pillar_1.2.1           geneplotter_1.56.0     reshape2_1.4.3        
## [70] XML_3.98-1.10          glue_1.3.0             evaluate_0.13         
## [73] blogdown_0.11          latticeExtra_0.6-28    modelr_0.1.4          
## [76] data.table_1.10.4-3    cellranger_1.1.0       gtable_0.2.0          
## [79] assertthat_0.2.0       xfun_0.5               xtable_1.8-2          
## [82] broom_0.4.3            survival_2.41-3        AnnotationDbi_1.40.0  
## [85] memoise_1.1.0          bindrcpp_0.2.2         cluster_2.0.6</code></pre>
