<div id="atgc-background"></div>

<style>
  #atgc-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: var(--code-bg);
    pointer-events: none;
    line-height: 1.2;
    word-break: break-all;
    padding: 20px;
    font-family: monospace;
    font-size: 14px;
  }

  .atgc-letter {
    color: #d3d3d3;
    cursor: pointer;
    pointer-events: auto;
    transition: color 0.1s ease;
    display: inline;
  }

  .atgc-letter:hover {
    color: #ff0000;
  }

  .atgc-letter.highlight {
    color: #ff0000;
  }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('atgc-background');
    
    // Fetch the FASTA file from static directory
    fetch('/errb3b.fa')
        .then(response => {
            if (!response.ok) {
                throw new Error('FASTA file not found');
            }
            return response.text();
        })
        .then(fastaContent => {
            // Parse FASTA: skip header lines (starting with '>') and concatenate sequence lines
            const lines = fastaContent.split('\n');
            let text = '';
            
            for (let line of lines) {
                line = line.trim();
                // Skip empty lines and header lines
                if (line && !line.startsWith('>')) {
                    text += line.toUpperCase();
                }
            }
            
            // Take first 5000 characters if sequence is longer
            text = text.substring(0, 5000);
            
            // Create spans for each letter
            text.split('').forEach((letter, index) => {
                const span = document.createElement('span');
                span.className = 'atgc-letter';
                span.textContent = letter;
                span.dataset.index = index;
                
                span.addEventListener('mouseenter', function() {
                    highlightAllTriplets(index, text);
                });
                
                span.addEventListener('mouseleave', function() {
                    removeHighlight();
                });
                
                container.appendChild(span);
            });
        })
        .catch(error => {
            console.error('Error loading FASTA file:', error);
            // Fallback to random letters if file cannot be loaded
            const letters = ['A', 'T', 'G', 'C'];
            const textLength = 5000;
            
            let text = '';
            for (let i = 0; i < textLength; i++) {
                text += letters[Math.floor(Math.random() * letters.length)];
            }
            
            text.split('').forEach((letter, index) => {
                const span = document.createElement('span');
                span.className = 'atgc-letter';
                span.textContent = letter;
                span.dataset.index = index;
                
                span.addEventListener('mouseenter', function() {
                    highlightAllTriplets(index, text);
                });
                
                span.addEventListener('mouseleave', function() {
                    removeHighlight();
                });
                
                container.appendChild(span);
            });
        });
    });

    function highlightAllTriplets(index, text) {
    // Extract the 3-letter sequence centered on hovered letter
    const start = Math.max(0, index - 1);
    const end = Math.min(text.length - 1, index + 1);
    const triplet = text.substring(start, end + 1);
    
    // Find all occurrences of this triplet
    const spans = document.querySelectorAll('.atgc-letter');
    
    for (let i = 0; i < text.length - 2; i++) {
        const currentTriplet = text.substring(i, i + 3);
        
        if (currentTriplet === triplet) {
        // Highlight all 3 letters of this match
        spans[i].classList.add('highlight');
        spans[i + 1].classList.add('highlight');
        spans[i + 2].classList.add('highlight');
        }
    }
    }

    function removeHighlight() {
    document.querySelectorAll('.atgc-letter').forEach(span => {
        span.classList.remove('highlight');
    });
    }

</script>
